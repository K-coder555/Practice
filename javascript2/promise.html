<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Promise 예제</title>
</head>
<body>

    <h1>Promise 예제</h1>
    <p>브라우저의 개발자 콘솔(F12)을 열어 Promise의 동작을 확인하세요.</p>
    <p>페이지를 새로고침하면 성공 또는 실패 결과가 랜덤으로 나타납니다.</p>

    <div id="result"></div>

    <script>
        const resultDiv = document.getElementById('result');

        // 1. Promise 객체 생성
        // 이 함수는 Promise를 반환합니다.
        function fetchData() {
            console.log("데이터 요청 시작...");
            resultDiv.innerHTML = "데이터를 가져오는 중... ⏳";

            return new Promise((resolve, reject) => {
                // 비동기 작업을 시뮬레이션하기 위해 setTimeout 사용 (예: 2초 후 실행)
                setTimeout(() => {
                    const isSuccess = Math.random() > 0.5; // 50% 확률로 성공 또는 실패

                    if (isSuccess) {
                        // 작업 성공 시 resolve 호출
                        const data = { user: "John Doe", id: 123 };
                        console.log("데이터 가져오기 성공! ✅");
                        resolve(data);
                    } else {
                        // 작업 실패 시 reject 호출
                        const error = new Error("서버에 연결할 수 없습니다.");
                        console.error("데이터 가져오기 실패! ❌");
                        reject(error);
                    }
                }, 2000);
            });
        }

        // 2. Promise 사용
        fetchData()
            .then(data => {
                // Promise가 이행(Fulfilled)되었을 때 실행 (성공)
                console.log("then() 블록 실행:", data);
                resultDiv.innerHTML = `
                    <h3>성공!</h3>
                    <p>사용자 이름: ${data.user}</p>
                    <p>사용자 ID: ${data.id}</p>
                `;
                resultDiv.style.color = 'green';
            })
            .catch(error => {
                // Promise가 거부(Rejected)되었을 때 실행 (실패)
                console.error("catch() 블록 실행:", error.message);
                resultDiv.innerHTML = `
                    <h3>실패!</h3>
                    <p>오류 메시지: ${error.message}</p>
                `;
                resultDiv.style.color = 'red';
            })
            .finally(() => {
                // 성공/실패 여부와 관계없이 항상 마지막에 실행
                console.log("finally() 블록 실행: 작업이 종료되었습니다.");
            });

        console.log("Promise가 생성되고 비동기 작업이 진행되는 동안 이 코드는 바로 실행됩니다.");

    </script>

</body>
</html>
